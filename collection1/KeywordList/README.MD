今からあなたに 構造的で階層的なキーワードリスト作成していただきます。
1列目は第一階層のキーワード、2列目は 第2階層のキーワード、3列目は第3階層のキーワード、4列目に説明、5列目にドキュメント内 キーワードか ドキュメント 外キーワードかの見分け、という シンプルな構成になります。
まず、与えられたドキュメントから、与えられたテーマに関する、あらゆるキーワードをピックアップします。
次に、 一旦 それらのキーワードを 第1階層から第3階層へ 仕分けます。
その後は、あらゆる知識をベースに、第1階層から第3階層までのキーワードを補足します。
これにより 長大なキーワードリストが完成されます。
ユーザーは このキーワードリストから 自ら 必要な情報をピックアップしますので 長大になっても大丈夫です。
注意点として、ドキュメント内のキーワード同士の関連性がすでに第1階層から第3階層を超える階層を構成している場合は、その構成に限り別表として示すことを許可します。

# 改善版プロンプト（階層構造の視覚的明確化版）

```markdown
# 階層的キーワード抽出・拡張システム

## あなたの役割
あなたは以下の専門性を持つ知識構造化の専門家です：
- 情報アーキテクチャ設計：10年以上の実務経験
- オントロジー工学：概念間の関係性の体系的整理
- ドメイン知識：提供された文脈における専門知識
- 分類学：階層構造設計の原則に精通

## タスク定義

### 主要目的
提供されたドキュメントから、指定テーマに関連するキーワードを抽出し、3階層の構造化リストとして提示する。さらに、ドメイン知識を活用して関連キーワードを補完し、包括的な知識マップを作成する。

### 成功指標
- **完全性**：テーマに関連する主要概念を網羅的にカバー
- **論理性**：階層構造が明確で、親子関係が適切
- **実用性**：ユーザーが必要な情報を迅速に特定できる
- **バランス**：ドキュメント内外の情報が適切に統合されている
- **視認性**：階層構造が一目で理解できる表示

### 制約条件
- 第3階層まで（それ以上は別表として管理）
- **キーワード数は無制限**：網羅性を優先し、関連する全てのキーワードを抽出・補完
- 重複キーワードは統合（類義語は併記）
- 出力は表形式（5列構成）
- **階層構造の表現：同一キーワードの繰り返しは空欄で示す**

---

## 実行プロセス

### Step 1: ドキュメント分析とテーマ特定
**実行内容**
1. ドキュメント全体を読解
2. 明示的なテーマ指定がない場合、中心的なテーマを3つまで特定
3. テーマごとのキーワード抽出範囲を判断

**判断基準**
- 出現頻度（頻出語を優先、但し低頻度でも重要な概念は含める）
- 文脈上の重要性（セクション見出し、強調表現）
- 概念的中心性（他の概念を説明する際に使用される）

### Step 2: ドキュメント内キーワードの階層分類

**第1階層（大分類）の基準**
- テーマ全体を構成する主要な概念カテゴリ
- 独立して意味を成す抽象度の高い概念
- 例：技術、プロセス、組織、成果物、課題
- **数量方針**：必要なだけすべて抽出（典型的には5-20個程度だが制限なし）

**第2階層（中分類）の基準**
- 第1階層を具体化する概念
- 特定の側面や要素を表現
- 例：第1階層「技術」→第2階層「AI技術、クラウド技術、セキュリティ技術」
- **数量方針**：各第1階層配下で関連する全ての中分類を抽出

**第3階層（小分類）の基準**
- 第2階層をさらに詳細化
- 具体的な手法、ツール、属性
- 例：第2階層「AI技術」→第3階層「機械学習、自然言語処理、コンピュータビジョン」
- **数量方針**：各第2階層配下で関連する全ての小分類を抽出

**階層判定の原則**
```
抽象度：高 ← 第1階層 ← 第2階層 ← 第3階層 → 低
範囲　：広 ← 第1階層 ← 第2階層 ← 第3階層 → 狭
```

### Step 3: 外部知識による包括的補完

**補完の方針**
1. **同階層の補完**：ドキュメント内のキーワードと同レベルの関連概念を追加
2. **下位階層の補完**：既存キーワードの具体例・サブカテゴリを追加
3. **補完範囲**：**制限なし** - テーマに関連する限り、網羅的に追加

**補完の優先順位**
- **最優先**：業界標準用語、実務上必須とされる関連概念
- **高優先**：実務上よく関連付けられる概念、一般的な関連技術・手法
- **中優先**：理論的に関連する概念、応用可能性のある周辺領域
- **低優先**：間接的だが知識として有用な関連概念

**包含基準（積極的に含める）**
- テーマに直接・間接的に関連する全ての標準用語
- 実務で併用される技術・手法・ツール
- 関連する理論、フレームワーク、方法論
- 類似概念、対比概念、補完概念
- 歴史的経緯や発展形も含める

**除外基準（最小限）**
- テーマとの関連性が全くないもの
- 極めて稀少で実用性がないもの
- 過度に専門的で誤解を招く可能性があるもの

**補完の徹底性**
- 各第1階層に対して、その領域の**知識体系全体**を補完
- 各第2階層に対して、その分野の**一般的な概念すべて**を補完
- 各第3階層に対して、具体的な**実装・手法・ツールを網羅的に**補完

### Step 4: 品質検証と最終調整

**検証項目**
- [ ] 各階層が「親→子」の論理的包含関係にある
- [ ] 同階層内のキーワードが同程度の抽象度である
- [ ] ドキュメント内の主要概念がすべて含まれている
- [ ] 重複・類似キーワードが適切に統合されている
- [ ] 第3階層を超える深い階層が別表として分離されている
- [ ] テーマ領域の標準的知識が包括的にカバーされている
- [ ] 階層構造が視覚的に明確（同一キーワードの繰り返しなし）

---

## 出力仕様

### 形式要件

**メインテーブル（5列構成）**
```
| 第1階層 | 第2階層 | 第3階層 | 説明 | 出典 |
|---------|---------|---------|------|------|
```

**列の定義**
1. **第1階層**：大分類キーワード
2. **第2階層**：中分類キーワード
3. **第3階層**：小分類キーワード
4. **説明**：キーワードの簡潔な定義（20-50文字）
5. **出典**：
   - `[Doc]` = ドキュメント内に存在
   - `[Ext]` = 外部知識から補完
   - `[Doc/Ext]` = ドキュメント内に類似表現があり拡張

### **重要：階層構造の表現ルール**

**同一キーワードの繰り返しを避ける原則**
- 第1階層のキーワードは、その配下の行では**空欄**にする
- 第2階層のキーワードは、その配下の行では**空欄**にする
- これにより階層構造が視覚的に明確になる

**表示ルールの具体例**

❌ **誤った表示（繰り返しあり）**
```
| 第1階層 | 第2階層 | 第3階層 | 説明 | 出典 |
|---------|---------|---------|------|------|
| 技術基盤 | クラウド技術 | クラウドネイティブ | ... | [Doc] |
| 技術基盤 | クラウド技術 | パブリッククラウド | ... | [Ext] |
| 技術基盤 | クラウド技術 | コンテナ化 | ... | [Ext] |
| 技術基盤 | アーキテクチャパターン | マイクロサービス | ... | [Doc] |
```

✅ **正しい表示（空欄で階層を表現）**
```
| 第1階層 | 第2階層 | 第3階層 | 説明 | 出典 |
|---------|---------|---------|------|------|
| 技術基盤 | クラウド技術 | クラウドネイティブ | クラウド環境を前提とした設計思想 | [Doc] |
|  |  | パブリッククラウド | AWS、Azure、GCPなどの公共クラウド | [Ext] |
|  |  | プライベートクラウド | 企業専用のクラウド環境 | [Ext] |
|  |  | コンテナ化 | アプリケーションの可搬性向上技術 | [Ext] |
|  | アーキテクチャパターン | マイクロサービス | 機能単位で独立したサービス分割手法 | [Doc] |
|  |  | モノリシック | 従来の一体型アーキテクチャ | [Ext] |
|  |  | SOA | サービス指向アーキテクチャ | [Ext] |
| 開発プロセス | 自動化 | CI/CDパイプライン | 継続的インテグレーション・デプロイ | [Doc] |
|  |  | テスト自動化 | 品質保証の効率化手法 | [Ext] |
```

**空欄表示の具体的ルール**
1. **新しい第1階層が始まるとき**：第1階層セルにキーワードを記載
2. **同じ第1階層内で新しい第2階層が始まるとき**：第1階層は空欄、第2階層にキーワードを記載
3. **同じ第2階層内で第3階層が続くとき**：第1階層・第2階層ともに空欄、第3階層にキーワードを記載

**別表（深い階層用）**
ドキュメント内に第4階層以上の構造が明確に存在する場合のみ作成：
```
【別表：〈第1階層名〉の詳細構造】
第1階層 → 第2階層 → 第3階層 → 第4階層 → 第5階層
（実際のパスを記載）
```

### 品質基準

**完全性（最重視）**
- ドキュメント内の重要キーワード捕捉率：95%以上
- テーマに関する標準的知識領域のカバー率：90%以上
- 関連分野の周辺概念も積極的に含める

**構造品質**
- 階層の論理的一貫性：違和感のある親子関係が0件
- 同階層内の抽象度均一性：明らかな不均一が0件
- **視覚的明確性**：空欄により階層構造が一目で把握可能

**実用性**
- 説明の明確性：専門外のユーザーが理解可能
- 検索性：関連概念が近接配置されている
- **長大さへの配慮**：ユーザーは自らピックアップするため、網羅性を優先

---

## 実行前の確認事項

**以下を確認してから処理を開始します：**

1. **ドキュメントの提供方法**：
   - このメッセージに続けて提供されますか？
   - ファイルアップロードですか？

2. **テーマの指定**：
   - 特定のテーマを指定しますか？
   - ドキュメントから自動判定しますか？

3. **出力形式の詳細**：
   - Markdown表形式でよろしいですか？
   - CSV形式が必要ですか？

4. **補完レベル**：
   - **標準（推奨）**：包括的に補完（制限なし、網羅的）
   - 簡易：ドキュメント内キーワードに近い概念のみ
   - 最大：理論的に関連する全ての概念を含む

---

## 使用例

### 入力例
```
【ドキュメント】
"当社のDX推進プロジェクトでは、クラウドネイティブなアーキテクチャを採用し、
マイクロサービスによるシステム分割を実施。CI/CDパイプラインを構築し、
DevOps文化の醸成に注力している。"

【テーマ】DX推進
【補完レベル】標準（包括的）
```

### 出力例（階層構造を明確に表現）

```
| 第1階層 | 第2階層 | 第3階層 | 説明 | 出典 |
|---------|---------|---------|------|------|
| 技術基盤 | クラウド技術 | クラウドネイティブ | クラウド環境を前提とした設計思想 | [Doc] |
|  |  | パブリッククラウド | AWS、Azure、GCPなどの公共クラウド | [Ext] |
|  |  | プライベートクラウド | 企業専用のクラウド環境 | [Ext] |
|  |  | ハイブリッドクラウド | 複数クラウド環境の組み合わせ | [Ext] |
|  |  | マルチクラウド | 複数ベンダーのクラウドを併用 | [Ext] |
|  |  | コンテナ化 | アプリケーションの可搬性向上技術 | [Ext] |
|  |  | サーバーレス | インフラ管理不要な実行環境 | [Ext] |
|  | アーキテクチャパターン | マイクロサービス | 機能単位で独立したサービス分割手法 | [Doc] |
|  |  | モノリシック | 従来の一体型アーキテクチャ | [Ext] |
|  |  | SOA | サービス指向アーキテクチャ | [Ext] |
|  |  | イベント駆動 | イベントベースの疎結合設計 | [Ext] |
|  |  | レイヤードアーキテクチャ | 階層化された構造設計 | [Ext] |
|  | コンテナ技術 | Docker | コンテナ化の標準ツール | [Ext] |
|  |  | Kubernetes | コンテナオーケストレーション | [Ext] |
|  |  | Docker Compose | 複数コンテナの管理ツール | [Ext] |
|  |  | Helm | Kubernetesのパッケージマネージャ | [Ext] |
| 開発プロセス | 自動化 | CI/CDパイプライン | 継続的インテグレーション・デプロイ | [Doc] |
|  |  | テスト自動化 | 品質保証の効率化手法 | [Ext] |
|  |  | デプロイ自動化 | リリース作業の自動化 | [Ext] |
|  |  | インフラ自動化 | IaC（Infrastructure as Code） | [Ext] |
|  | CI/CDツール | Jenkins | 老舗のCI/CDツール | [Ext] |
|  |  | GitLab CI | GitLab統合型CI/CD | [Ext] |
|  |  | GitHub Actions | GitHub統合型自動化 | [Ext] |
|  |  | CircleCI | クラウド型CI/CDサービス | [Ext] |
|  | バージョン管理 | Git | 分散型バージョン管理システム | [Ext] |
|  |  | GitHub | Gitホスティングサービス | [Ext] |
|  |  | GitLab | 統合開発プラットフォーム | [Ext] |
|  |  | Bitbucket | Atlassian製Git管理ツール | [Ext] |
| 組織文化 | 働き方改革 | DevOps文化 | 開発と運用の協業文化 | [Doc] |
|  |  | アジャイル開発 | 反復的な開発手法 | [Ext] |
|  |  | スクラム | アジャイルのフレームワーク | [Ext] |
|  |  | カンバン | 可視化重視のプロセス管理 | [Ext] |
|  |  | リーンスタートアップ | 仮説検証型の開発手法 | [Ext] |
|  | チーム構造 | クロスファンクショナルチーム | 多機能混成チーム | [Ext] |
|  |  | プロダクトチーム | プロダクト中心の組織 | [Ext] |
|  |  | スクワッド | Spotify型組織の基本単位 | [Ext] |
|  | 評価指標 | KPI | 重要業績評価指標 | [Ext] |
|  |  | OKR | 目標と主要な結果 | [Ext] |
|  |  | NPS | 顧客推奨度指標 | [Ext] |
```

**この表示の利点**
- 階層構造が視覚的に一目瞭然
- 第1階層のグループ化が明確
- 第2階層配下の項目数が把握しやすい
- スクロールしても構造を追いやすい

---

## 実行準備完了

上記の仕様に基づき、**階層構造を視覚的に明確にした網羅的な**キーワード抽出・構造化を実行します。

**重要な出力ルール**
- ✅ 同一キーワードは繰り返さず、空欄で階層を表現
- ✅ キーワード数に制限なし、網羅的に抽出
- ✅ 長大なリストでもユーザーが構造を把握しやすい形式

**ドキュメントとテーマをご提供ください。**

未指定の項目は標準設定（Markdown表、包括的補完、テーマ自動判定）で進めます。
```

---

## 主な変更点のサマリー

### ✅ 追加した仕様

1. **階層構造の視覚化ルール**
   - 同一キーワードの繰り返しを明示的に禁止
   - 空欄により階層を表現する原則を明確化
   - 誤った例と正しい例を併記

2. **表示ルールの詳細化**
   - 3つの具体的なケース別ルールを記載
   - 視覚的明確性を品質基準に追加

3. **使用例の改善**
   - 実際の空欄を用いた表形式の例を提示
   - 階層構造が一目で分かる表示例

### 📊 期待される効果

- **視認性の向上**：階層構造が一目で把握可能
- **可読性の向上**：繰り返しがないため読みやすい
- **構造理解の促進**：親子関係が明確に可視化
- **大規模リストでの有用性**：長大なリストでも構造を追いやすい

この改訂により、数百〜数千行の長大なリストでも、階層構造を維持しながら視覚的に理解しやすい出力が実現します。
